{"version":3,"file":"index.js","sources":["../src/js/pixabay-api.js","../src/js/render-functions.js","../src/main.js"],"sourcesContent":["import axios from 'axios';\n\n//TODO get array img axios API pixabay\nexport default async function getImagesByQuery(query, page) {\n  const params = new URLSearchParams({\n    key: '51145498-f51992c20e23a6f6f425bd97f',\n    q: query,\n    image_type: 'photo',\n    orientation: 'horizontal',\n    max_width: 320,\n    max_height: 200,\n    safesearch: 'true',\n    per_page: 15,\n    page: page,\n  });\n\n  const url = `https://pixabay.com/api/?${params}`;\n\n  try {\n    const response = await axios.get(url);\n    return {\n      hits: response.data.hits,\n      totalHits: response.data.totalHits,\n    };\n  } catch (error) {\n    console.error('Ошибка', error);\n    return [];\n  }\n}\n","import SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\n\n//TODO default settings for simplelightbox\nconst lightbox = new SimpleLightbox('.gallery a', {\n  caption: true,\n  captionDelay: 250,\n});\nconst gallery = document.querySelector('.gallery');\n\n//TODO create and add gallery to DOM\nfunction createGallery(hits) {\n  let markup = '';\n  console.log(hits);\n  hits?.forEach(image => {\n    markup += `<li> \n      <a href= \"${image.largeImageURL}\" class=\"large-img\">\n       <img src=\"${image.webformatURL}\" class=\"small-img\" alt=\"${image.tags}\">\n       </a>\n       <div class=\"under-image-info\">\n       <p> <span> Likes </span> <br> ${image.likes} </p>\n       <p> <span> Views </span> <br> ${image.views} </p>\n       <p> <span> Comments </span> <br> ${image.comments} </p>\n       <p> <span> Downloads </span> <br> ${image.downloads} </p>\n       </div>\n\n    </li> `;\n  });\n  gallery.insertAdjacentHTML('beforeend', markup);\n\n  lightbox.refresh();\n}\n//TODO clear gallery through innerHTML\nfunction clearGallery() {\n  const gallery = document.querySelector('.gallery'); // или ваш селектор\n  if (gallery) {\n    gallery.innerHTML = '';\n  }\n}\n\n//TODO show spinner\nfunction showLoader() {\n  const loader = document.querySelector('.loader');\n  if (loader) {\n    loader.style.display = 'block';\n  }\n}\n//TODO hide spinner\nfunction hideLoader() {\n  const loader = document.querySelector('.loader');\n  if (loader) {\n    loader.style.display = 'none';\n  }\n}\n\nconst btnLoadMore = document.querySelector('.js-load-more-btn');\n\nconst showLoadMoreButton = () => (btnLoadMore.style.display = 'block');\nconst hideLoadMoreButton = () => (btnLoadMore.style.display = 'none');\n\nexport {\n  createGallery,\n  clearGallery,\n  showLoader,\n  hideLoader,\n  showLoadMoreButton,\n  hideLoadMoreButton,\n};\n","import getImagesByQuery from './js/pixabay-api.js';\nimport {\n  createGallery,\n  clearGallery,\n  showLoader,\n  hideLoader,\n  showLoadMoreButton,\n  hideLoadMoreButton,\n} from './js/render-functions.js';\nimport iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\n\nconst formSubmit = document.querySelector('.form');\n\nlet inputValue = '';\nlet lastInputValue = '';\nlet currentPage = 1;\nconst iziToastDefaults = {\n  position: 'topRight',\n  timeout: 4000,\n  close: true,\n  progressBar: true,\n  icon: 'fas fa-check',\n  closeOnClick: false,\n  pauseOnHover: true,\n};\n\n//TODO create gallery => submit trigger\nformSubmit.addEventListener('submit', async function (e) {\n  e.preventDefault();\n  hideLoadMoreButton();\n  if (formSubmit.elements['search-text'].value.trim() === '') {\n    iziToast.warning({\n      message: \"Input value can't be empty!\",\n      color: 'red',\n      ...iziToastDefaults,\n    });\n    return;\n  }\n  inputValue = formSubmit.elements['search-text'].value.trim();\n\n  lastInputValue = inputValue;\n  currentPage = 1;\n  clearGallery();\n  const imagesObj = await getImages(currentPage);\n  const images = imagesObj.hits;\n\n  createGallery(images);\n  if (images.length >= 15) {\n    showLoadMoreButton();\n  }\n});\n\n//TODO get images by input value, show iziToast messages\nlet isLoading = false;\nasync function getImages(currentPage) {\n  if (isLoading) {\n    return [];\n  }\n  isLoading = true;\n  showLoader();\n  try {\n    const getObjFromAPI = await getImagesByQuery(inputValue, currentPage);\n    if (getObjFromAPI.hits.length === 0) {\n      iziToast.warning({\n        message:\n          'Sorry, there are no images matching <br> your search query. Please try again!',\n        color: 'red',\n        ...iziToastDefaults,\n      });\n\n      return [];\n    }\n    return getObjFromAPI;\n  } catch (error) {\n    iziToast.error({\n      message: `Oops, something went wrong! ${error}`,\n      color: 'red',\n      ...iziToastDefaults,\n    });\n    return [];\n  } finally {\n    hideLoader();\n    isLoading = false;\n  }\n}\n\nconst btnLoadMoreButton = document.querySelector('.js-load-more-btn');\n\nbtnLoadMoreButton.addEventListener('click', async function () {\n  if (lastInputValue === inputValue) {\n    currentPage++;\n\n    const imagesObject = await getImages(currentPage);\n    const availableImg = imagesObject.totalHits;\n    const availablePages = Math.ceil(availableImg / 15);\n\n    if (currentPage >= availablePages || availableImg < 15) {\n      hideLoadMoreButton();\n      iziToast.warning({\n        message: \"We are sorry, but you've reached the end of search results\",\n        color: 'red',\n        ...iziToastDefaults,\n      });\n    }\n\n    const imgArr = imagesObject.hits;\n    if (imgArr?.length > 0) {\n      createGallery(imgArr);\n      smoothScroll();\n    } else {\n      hideLoadMoreButton();\n    }\n  }\n});\n\nfunction smoothScroll() {\n  const smallImg = document.querySelector('li');\n  const rect = smallImg.getBoundingClientRect();\n  const doubleHeight = rect.height * 2;\n  window.scrollBy({\n    top: doubleHeight,\n    behavior: 'smooth',\n  });\n}\n"],"names":["getImagesByQuery","query","page","url","response","axios","error","lightbox","SimpleLightbox","gallery","createGallery","hits","markup","image","clearGallery","showLoader","loader","hideLoader","btnLoadMore","showLoadMoreButton","hideLoadMoreButton","formSubmit","inputValue","lastInputValue","currentPage","iziToastDefaults","iziToast","images","getImages","isLoading","getObjFromAPI","btnLoadMoreButton","imagesObject","availableImg","availablePages","imgArr","smoothScroll","doubleHeight"],"mappings":"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"}