{"version":3,"file":"index.js","sources":["../src/js/render-functions.js","../src/js/pixabay-api.js","../src/main.js"],"sourcesContent":["import SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\n\n//TODO default settings for simplelightbox\nconst lightbox = new SimpleLightbox('.gallery a', {\n  caption: true,\n  captionDelay: 250,\n});\nconst gallery = document.querySelector('.gallery');\n\n//TODO create and add gallery to DOM\nfunction createGallery(hits) {\n  let markup = '';\n  hits?.forEach(image => {\n    markup += `<li> \n      <a href= \"${image.largeImageURL}\" class=\"large-img\">\n       <img src=\"${image.webformatURL}\" class=\"small-img\" alt=\"${image.tags}\">\n       </a>\n       <div class=\"under-image-info\">\n       <p> <span> Likes </span> <br> ${image.likes} </p>\n       <p> <span> Views </span> <br> ${image.views} </p>\n       <p> <span> Comments </span> <br> ${image.comments} </p>\n       <p> <span> Downloads </span> <br> ${image.downloads} </p>\n       </div>\n\n    </li> `;\n  });\n  gallery.insertAdjacentHTML('beforeend', markup);\n\n  lightbox.refresh();\n}\n//TODO clear gallery through innerHTML\nfunction clearGallery() {\n  const gallery = document.querySelector('.gallery'); // или ваш селектор\n  if (gallery) {\n    gallery.innerHTML = '';\n  }\n}\n\n//TODO show spinner\nfunction showLoader() {\n  const loader = document.querySelector('.loader');\n  if (loader) {\n    loader.style.display = 'block';\n  }\n}\n//TODO hide spinner\nfunction hideLoader() {\n  const loader = document.querySelector('.loader');\n  if (loader) {\n    loader.style.display = 'none';\n  }\n}\n\nconst btnLoadMore = document.querySelector('.js-load-more-btn');\n\nconst showLoadMoreButton = () => (btnLoadMore.style.display = 'block');\nconst hideLoadMoreButton = () => (btnLoadMore.style.display = 'none');\n\nexport {\n  createGallery,\n  clearGallery,\n  showLoader,\n  hideLoader,\n  showLoadMoreButton,\n  hideLoadMoreButton,\n};\n","import axios from 'axios';\nimport { hideLoader } from './render-functions.js';\n\n//TODO get array img axios API pixabay\nexport default async function getImagesByQuery(query, page) {\n  const params = new URLSearchParams({\n    key: '51145498-f51992c20e23a6f6f425bd97f',\n    q: query,\n    image_type: 'photo',\n    orientation: 'horizontal',\n    max_width: 320,\n    max_height: 200,\n    safesearch: 'true',\n    per_page: 15,\n    page: page,\n  });\n\n  const url = `https://pixabay.com/api/?${params}`;\n\n  try {\n    const response = await axios.get(url);\n    return {\n      hits: response.data.hits,\n      totalHits: response.data.totalHits,\n    };\n  } catch (error) {\n    console.error('Ошибка', error);\n    return [];\n  }\n}\n","import getImagesByQuery from './js/pixabay-api.js';\nimport {\n  createGallery,\n  clearGallery,\n  showLoader,\n  hideLoader,\n  showLoadMoreButton,\n  hideLoadMoreButton,\n} from './js/render-functions.js';\nimport iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\n\nconst formSubmit = document.querySelector('.form');\n\nlet inputValue = '';\nlet lastInputValue = '';\nlet currentPage = 1;\nconst iziToastDefaults = {\n  position: 'topRight',\n  timeout: 4000,\n  close: true,\n  progressBar: true,\n  icon: 'fas fa-check',\n  closeOnClick: false,\n  pauseOnHover: true,\n};\n\n//TODO create gallery => submit trigger\nformSubmit.addEventListener('submit', async function (e) {\n  e.preventDefault();\n  hideLoadMoreButton();\n  if (formSubmit.elements['search-text'].value.trim() === '') {\n    iziToast.warning({\n      message: \"Input value can't be empty!\",\n      color: 'red',\n      ...iziToastDefaults,\n    });\n    return;\n  }\n\n  inputValue = formSubmit.elements['search-text'].value.trim();\n\n  lastInputValue = inputValue;\n  currentPage = 1;\n  clearGallery();\n  const imagesObj = await getImages(currentPage);\n  const images = imagesObj.hits;\n\n  if (!images || !Array.isArray(images) || images.length === 0) {\n    iziToast.warning({\n      message:\n        'Sorry, there are no images matching <br> your search query. Please try again!',\n      color: 'red',\n      ...iziToastDefaults,\n    });\n    return;\n  }\n\n  createGallery(images);\n  if (images.length >= 15) {\n    showLoadMoreButton();\n  }\n\n  if (images && images.length < 15) {\n    iziToast.warning({\n      message: \"We are sorry, but you've reached the end of search results\",\n      color: 'red',\n      ...iziToastDefaults,\n    });\n  }\n});\n\n//TODO get images by input value, show iziToast messages\nlet isLoading = false;\nasync function getImages(currentPage) {\n  if (isLoading) {\n    return { hits: [] }; // объект с пустым массивом\n  }\n  isLoading = true;\n  showLoader();\n  try {\n    const getObjFromAPI = await getImagesByQuery(inputValue, currentPage);\n    const hits = getObjFromAPI.hits;\n\n    if (!hits || !Array.isArray(hits) || hits.length === 0) {\n      return { hits: [] };\n    }\n    return getObjFromAPI;\n  } catch (error) {\n    iziToast.error({\n      message: `Oops, something went wrong! ${error}`,\n      color: 'red',\n      ...iziToastDefaults,\n    });\n    return { hits: [] }; // объект с пустым массивом\n  } finally {\n    hideLoader();\n    isLoading = false;\n  }\n}\n\nconst btnLoadMoreButton = document.querySelector('.js-load-more-btn');\n\nbtnLoadMoreButton.addEventListener('click', async function () {\n  if (lastInputValue === inputValue) {\n    currentPage++;\n\n    const imagesObject = await getImages(currentPage);\n    const availableImg = imagesObject.totalHits || 0;\n    const availablePages = Math.ceil(availableImg / 15);\n\n    if (currentPage >= availablePages || availableImg < 15) {\n      hideLoadMoreButton();\n      iziToast.warning({\n        message: \"We are sorry, but you've reached the end of search results\",\n        color: 'red',\n        ...iziToastDefaults,\n      });\n    }\n\n    const imgArr = imagesObject.hits || [];\n    if (imgArr?.length > 0) {\n      createGallery(imgArr);\n      smoothScroll();\n    } else {\n      hideLoadMoreButton();\n    }\n  }\n});\n\nfunction smoothScroll() {\n  const smallImg = document.querySelector('li');\n  const rect = smallImg.getBoundingClientRect();\n  const doubleHeight = rect.height * 2;\n  window.scrollBy({\n    top: doubleHeight,\n    behavior: 'smooth',\n  });\n}\n"],"names":["lightbox","SimpleLightbox","gallery","createGallery","hits","markup","image","clearGallery","showLoader","loader","hideLoader","btnLoadMore","showLoadMoreButton","hideLoadMoreButton","getImagesByQuery","query","page","url","response","axios","error","formSubmit","inputValue","lastInputValue","currentPage","iziToastDefaults","e","iziToast","images","getImages","isLoading","getObjFromAPI","btnLoadMoreButton","imagesObject","availableImg","availablePages","imgArr","smoothScroll","doubleHeight"],"mappings":"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"}